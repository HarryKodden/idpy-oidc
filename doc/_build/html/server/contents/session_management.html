
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Session Management &#8212; idpyoidc 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tests" href="developers.html" />
    <link rel="prev" title="Usage" href="usage.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="session-management">
<h1>Session Management<a class="headerlink" href="#session-management" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference internal" href="#id1">About session management</a></dt><dd><ul>
<li><p><a class="reference internal" href="#id2">Design criteria</a></p></li>
<li><p><a class="reference internal" href="#id3">Database layout</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="#id4">The information structure</a></dt><dd><ul>
<li><p><a class="reference internal" href="#id5">Session key</a></p></li>
<li><p><a class="reference internal" href="#id6">User session information</a></p></li>
<li><p><a class="reference internal" href="#id7">Client session information</a></p></li>
<li><p><a class="reference internal" href="#id8">Grant information</a></p></li>
<li><p><a class="reference internal" href="#id9">Token</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><p><a class="reference internal" href="#id15">Session Info API</a></p></li>
<li><p><a class="reference internal" href="#id21">Grant API</a></p></li>
<li><p><a class="reference internal" href="#id22">Token API</a></p></li>
<li><dl class="simple">
<dt><a class="reference internal" href="#id23">Session Manager API</a></dt><dd><ul>
<li><p><a class="reference internal" href="#id24">create_session</a></p></li>
<li><p><a class="reference internal" href="#id25">add_grant</a></p></li>
<li><p><a class="reference internal" href="#id26">find_token</a></p></li>
<li><p><a class="reference internal" href="#id27">get_authentication_event</a></p></li>
<li><p><a class="reference internal" href="#id28">get_client_session_info</a></p></li>
<li><p><a class="reference internal" href="#id29">get_grant_by_response_type</a></p></li>
<li><p><a class="reference internal" href="#id30">get_session_info</a></p></li>
<li><p><a class="reference internal" href="#id31">get_session_info_by_token</a></p></li>
<li><p><a class="reference internal" href="#id32">get_sids_by_user_id</a></p></li>
<li><p><a class="reference internal" href="#id33">get_user_info</a></p></li>
<li><p><a class="reference internal" href="#id34">grants</a></p></li>
<li><p><a class="reference internal" href="#id35">revoke_client_session</a></p></li>
<li><p><a class="reference internal" href="#id36">revoke_grant</a></p></li>
<li><p><a class="reference internal" href="#id37">revoke_token</a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="section" id="about-session-management">
<h2>About session management<a class="headerlink" href="#about-session-management" title="Permalink to this headline">¶</a></h2>
<p id="id1">The OIDC Session Management draft defines session to be:</p>
<blockquote>
<div><p>Continuous period of time during which an End-User accesses a Relying
Party relying on the Authentication of the End-User performed by the
OpenID Provider.</p>
</div></blockquote>
<p>Note that we are dealing with a Single Sign On (SSO) context here.
If for some reason the OP does not want to support SSO then the
session management has to be done a bit differently. In that case each
session (user_id,client_id) would have its own authentication event. Not one
shared between the sessions.</p>
<div class="section" id="design-criteria">
<h3>Design criteria<a class="headerlink" href="#design-criteria" title="Permalink to this headline">¶</a></h3>
<p id="id2">So a session is defined by a user and a Relying Party. If one adds to that
that a user can have several sessions active at the same time each one against
a unique Relying Party we have the bases for session management.</p>
<p>Furthermore the user may well decide on different rules for different
relying parties for releasing user
attributes, where and how issued access tokens could be used and whether
refresh tokens should be issued or not.</p>
<p>We also need to keep track on which tokens where used to mint new tokens
such that we can easily revoked a suite of tokens all with a common ancestor.</p>
</div>
<div class="section" id="database-layout">
<h3>Database layout<a class="headerlink" href="#database-layout" title="Permalink to this headline">¶</a></h3>
<p id="id3">The database is organized in 3 levels. The top one being the users.
Below that the Relying Parties and at the bottom what is called grants.</p>
<p>Grants organize authorization codes, access tokens and refresh tokens (and
possibly other types of tokens) in a comprehensive way. More about that below.</p>
<p>There may be many Relying Parties below a user and many grants below a
Relying Party.</p>
</div>
</div>
<div class="section" id="the-information-structure">
<h2>The information structure<a class="headerlink" href="#the-information-structure" title="Permalink to this headline">¶</a></h2>
<p id="id4">As stated above there are 3 layers: user session information, client session
information and grants. But first the keys to the information.</p>
<div class="section" id="session-key">
<h3>Session key<a class="headerlink" href="#session-key" title="Permalink to this headline">¶</a></h3>
<p id="id5">A key to the session information is based on a list. The first item being the
user identifier, the second the client identifier and the third the grant
identifier.
If you only want the user session information then the key is a list with one
item the user id. If you want the client session information the key is a
list with 2 items (user_id, client_id). And lastly if you want a grant then
the key is a list with 3 elements (user_id, client_id, grant_id).</p>
<dl class="simple">
<dt>Example::</dt><dd><p>“diana;;KtEST70jZx1x;;85544c9cace411ebab53559c5425fcc0”</p>
</dd>
</dl>
<p>A <em>session identifier</em> is constructed using the <strong>session_key</strong> function.
It takes as input the 3 elements list.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session_id</span> <span class="o">=</span> <span class="n">session_key</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">grant_id</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the function <strong>unpack_session_key</strong> you can get the elements from a
session_id.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_id</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">grant_id</span> <span class="o">=</span> <span class="n">unpack_session_id</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="user-session-information">
<h3>User session information<a class="headerlink" href="#user-session-information" title="Permalink to this headline">¶</a></h3>
<p id="id6">Houses the authentication event information which is the same for all session
connected to a user.
Here we also have a list of all the clients that this user has a session with.
Expressed as a dictionary this can look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;authentication_event&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="s1">&#39;diana&#39;</span><span class="p">,</span>
        <span class="s1">&#39;authn_info&#39;</span><span class="p">:</span> <span class="s2">&quot;urn:oasis:names:tc:SAML:2.0:ac:classes:InternetProtocolPassword&quot;</span><span class="p">,</span>
        <span class="s1">&#39;authn_time&#39;</span><span class="p">:</span> <span class="mi">1605515787</span><span class="p">,</span>
        <span class="s1">&#39;valid_until&#39;</span><span class="p">:</span> <span class="mi">1605519387</span>
    <span class="p">},</span>
    <span class="s1">&#39;subordinate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;client_1&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="client-session-information">
<h3>Client session information<a class="headerlink" href="#client-session-information" title="Permalink to this headline">¶</a></h3>
<p id="id7">The client specific information of the session information.
Presently only the authorization request and the subject identifier (sub).
The subordinates to this set of information are the grants:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;authorization_request&#39;</span><span class="p">:{</span>
        <span class="s1">&#39;client_id&#39;</span><span class="p">:</span> <span class="s1">&#39;client_1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect_uri&#39;</span><span class="p">:</span> <span class="s1">&#39;https://example.com/cb&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;openid&#39;</span><span class="p">,</span> <span class="s1">&#39;research_and_scholarship&#39;</span><span class="p">],</span>
        <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;STATE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;response_type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;sub&#39;</span><span class="p">:</span> <span class="s1">&#39;117afe8d7bb0ace8e7fb2706034ab2d3fbf17f0fd4c949aa9c23aedd051cc9e3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;subordinate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;e996c61227e711eba173acde48001122&#39;</span><span class="p">],</span>
    <span class="s1">&#39;revoked&#39;</span><span class="p">:</span> <span class="kc">False</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="grant-information">
<h3>Grant information<a class="headerlink" href="#grant-information" title="Permalink to this headline">¶</a></h3>
<p id="id8">Grants are created by an authorization subsystem in an OP. If the grant is
created in connection with an user authentication the authorization system
might normally ask the user for usage consent and then base the construction
of the grant on that consent.</p>
<p>If an authorization server can act as a Security Token Service (STS) as
defined by <a class="reference external" href="https://tools.ietf.org/html/rfc8693">Token Exchange [RFC-8693]</a>
then no user is involved. In the context of session management the STS is
equivalent to a user.</p>
<p>Grant information contains information about user consent and issued tokens.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;grant&quot;</span><span class="p">,</span>
    <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;openid&quot;</span><span class="p">,</span> <span class="s2">&quot;research_and_scholarship&quot;</span><span class="p">],</span>
    <span class="s2">&quot;authorization_details&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
    <span class="s2">&quot;claims&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;userinfo&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;sub&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
            <span class="s2">&quot;given_name&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
            <span class="s2">&quot;family_name&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
            <span class="s2">&quot;email_verified&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
            <span class="s2">&quot;eduperson_scoped_affiliation&quot;</span><span class="p">:</span> <span class="n">null</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;client_1&quot;</span><span class="p">],</span>
    <span class="s2">&quot;issued_at&quot;</span><span class="p">:</span> <span class="mi">1605452123</span><span class="p">,</span>
    <span class="s2">&quot;not_before&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;expires_at&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;revoked&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;issued_token&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span>
            <span class="s2">&quot;issued_at&quot;</span><span class="p">:</span> <span class="mi">1605452123</span><span class="p">,</span>
            <span class="s2">&quot;not_before&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;expires_at&quot;</span><span class="p">:</span> <span class="mi">1605452423</span><span class="p">,</span>
            <span class="s2">&quot;revoked&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Z0FBQUFBQmZzVUZieDFWZy1fbjE2ckxvZkFTVC1ZTHJIVlk0Z09tOVk1M0RsOVNDbkdfLTIxTUhILWs4T29kM1lmV015UEN1UGxrWkxLTkVXOEg1WVJLNjh3MGlhMVdSRWhYcUY4cGdBQkJEbzJUWUQ3UGxTUWlJVDNFUHFlb29PWUFKcjNXeHdRM1hDYzRIZnFrYjhVZnIyTFhvZ2Y0NUhjR1VBdzE0STVEWmJ3WkttTk1OYXQtTHNtdHJwYk1nWnl3MUJqSkdWZGFtdVNfY21VNXQxY3VzalpIczBWbGFueVk0TVZ2N2d2d0hVWTF4WG56TDJ6bz0=&quot;</span><span class="p">,</span>
            <span class="s2">&quot;usage_rules&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
                <span class="s2">&quot;supports_minting&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;access_token&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;refresh_token&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;id_token&quot;</span>
                <span class="p">],</span>
                <span class="s2">&quot;max_usage&quot;</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">},</span>
            <span class="s2">&quot;used&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;based_on&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;96d19bea275211eba43bacde48001122&quot;</span>
       <span class="p">},</span>
       <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;access_token&quot;</span><span class="p">,</span>
            <span class="s2">&quot;issued_at&quot;</span><span class="p">:</span> <span class="mi">1605452123</span><span class="p">,</span>
            <span class="s2">&quot;not_before&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;expires_at&quot;</span><span class="p">:</span> <span class="mi">1605452723</span><span class="p">,</span>
            <span class="s2">&quot;revoked&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Z0FBQUFBQmZzVUZiaWVRbi1IS2k0VW4wVDY1ZmJHeEVCR1hVODBaQXR6MWkzelNBRFpOS2tRM3p4WWY5Y1J6dk5IWWpnelRETGVpSG52b0d4RGhjOWphdWp4eW5xZEJwQzliaS16cXFCcmRFbVJqUldsR1Z3SHdTVVlWbkpHak54TmJaSTV2T3NEQ0Y1WFkxQkFyamZHbmd4V0RHQ3k1MVczYlYwakEyM010SGoyZk9tUVVxbWdYUzBvMmRRNVlZMUhRSnM4WFd2QzRkVmtWNVJ1aVdJSXQyWnpVTlRiZnMtcVhKTklGdzBzdDJ3RkRnc1A1UEw2Yz0=&quot;</span><span class="p">,</span>
            <span class="s2">&quot;usage_rules&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s2">&quot;used&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;based_on&quot;</span><span class="p">:</span> <span class="s2">&quot;Z0FBQUFBQmZzVUZieDFWZy1fbjE2ckxvZkFTVC1ZTHJIVlk0Z09tOVk1M0RsOVNDbkdfLTIxTUhILWs4T29kM1lmV015UEN1UGxrWkxLTkVXOEg1WVJLNjh3MGlhMVdSRWhYcUY4cGdBQkJEbzJUWUQ3UGxTUWlJVDNFUHFlb29PWUFKcjNXeHdRM1hDYzRIZnFrYjhVZnIyTFhvZ2Y0NUhjR1VBdzE0STVEWmJ3WkttTk1OYXQtTHNtdHJwYk1nWnl3MUJqSkdWZGFtdVNfY21VNXQxY3VzalpIczBWbGFueVk0TVZ2N2d2d0hVWTF4WG56TDJ6bz0=&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;96d1c840275211eba43bacde48001122&quot;</span>
       <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;96d16d3c275211eba43bacde48001122&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The parameters are described below</p>
<div class="section" id="scope">
<h4>scope<a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h4>
<p>This is the scope that was chosen for this grant. Either by the user or by
some rules that the Authorization Server runs by.</p>
</div>
<div class="section" id="authorization-details">
<h4>authorization_details<a class="headerlink" href="#authorization-details" title="Permalink to this headline">¶</a></h4>
<p>Presently a place hold. But this is expected to be information on how the
authorization was performed. What input was used and so on.</p>
</div>
<div class="section" id="claims">
<h4>claims<a class="headerlink" href="#claims" title="Permalink to this headline">¶</a></h4>
<p>The set of claims that should be returned in different circumstances. The
syntax that is defined in
<a class="reference external" href="https://openid.net/specs/openid-connect-core-1_0.html#ClaimsParameter">https://openid.net/specs/openid-connect-core-1_0.html#ClaimsParameter</a>
is used. With one addition, beside <em>userinfo</em> and <em>id_token</em> we have added
<em>introspection</em>.</p>
</div>
<div class="section" id="resources">
<h4>resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h4>
<p>This are the resource servers and other entities that should be accepted
as users of issued access tokens.</p>
</div>
<div class="section" id="issued-at">
<h4>issued_at<a class="headerlink" href="#issued-at" title="Permalink to this headline">¶</a></h4>
<p>When the grant was created. Its value is a JSON number representing the number
of seconds from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</p>
</div>
<div class="section" id="not-before">
<h4>not_before<a class="headerlink" href="#not-before" title="Permalink to this headline">¶</a></h4>
<p>If the usage of the grant should be delay, this is when it can start being used.
Its value is a JSON number representing the number
of seconds from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</p>
</div>
<div class="section" id="expires-at">
<h4>expires_at<a class="headerlink" href="#expires-at" title="Permalink to this headline">¶</a></h4>
<p>When the grant expires.
Its value is a JSON number representing the number
of seconds from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</p>
</div>
<div class="section" id="revoked">
<h4>revoked<a class="headerlink" href="#revoked" title="Permalink to this headline">¶</a></h4>
<p>If the grant has been revoked.</p>
</div>
<div class="section" id="issued-token">
<h4>issued_token<a class="headerlink" href="#issued-token" title="Permalink to this headline">¶</a></h4>
<p>Tokens that has been issued based on this grant. There is no limitation
as to which tokens can be issued. Though presently we only have:</p>
<ul class="simple">
<li><p>authorization_code,</p></li>
<li><p>access_token and</p></li>
<li><p>refresh_token</p></li>
</ul>
</div>
<div class="section" id="id">
<h4>id<a class="headerlink" href="#id" title="Permalink to this headline">¶</a></h4>
<p>The grant identifier.</p>
</div>
</div>
<div class="section" id="token">
<h3>Token<a class="headerlink" href="#token" title="Permalink to this headline">¶</a></h3>
<p id="id9">As mention above there are presently only 3 token types that are defined:</p>
<ul class="simple">
<li><p>authorization_code,</p></li>
<li><p>access_token and</p></li>
<li><p>refresh_token</p></li>
</ul>
<p>A token is described as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span>
    <span class="s2">&quot;issued_at&quot;</span><span class="p">:</span> <span class="mi">1605452123</span><span class="p">,</span>
    <span class="s2">&quot;not_before&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;expires_at&quot;</span><span class="p">:</span> <span class="mi">1605452423</span><span class="p">,</span>
    <span class="s2">&quot;revoked&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Z0FBQUFBQmZzVUZieDFWZy1fbjE2ckxvZkFTVC1ZTHJIVlk0Z09tOVk1M0RsOVNDbkdfLTIxTUhILWs4T29kM1lmV015UEN1UGxrWkxLTkVXOEg1WVJLNjh3MGlhMVdSRWhYcUY4cGdBQkJEbzJUWUQ3UGxTUWlJVDNFUHFlb29PWUFKcjNXeHdRM1hDYzRIZnFrYjhVZnIyTFhvZ2Y0NUhjR1VBdzE0STVEWmJ3WkttTk1OYXQtTHNtdHJwYk1nWnl3MUJqSkdWZGFtdVNfY21VNXQxY3VzalpIczBWbGFueVk0TVZ2N2d2d0hVWTF4WG56TDJ6bz0=&quot;</span><span class="p">,</span>
    <span class="s2">&quot;usage_rules&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
        <span class="s2">&quot;supports_minting&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;access_token&quot;</span><span class="p">,</span>
            <span class="s2">&quot;refresh_token&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id_token&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;max_usage&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
    <span class="s2">&quot;used&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;based_on&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;96d19bea275211eba43bacde48001122&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="type">
<h4>type<a class="headerlink" href="#type" title="Permalink to this headline">¶</a></h4>
<p>The type of token.</p>
</div>
<div class="section" id="id10">
<h4>issued_at<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>When the token was created. Its value is a JSON number representing the number
of seconds from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</p>
</div>
<div class="section" id="id11">
<h4>not_before<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>If the start of the usage of the token is to be delay, this is until when.
Its value is a JSON number representing the number
of seconds from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</p>
</div>
<div class="section" id="id12">
<h4>expires_at<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>When the token expires.
Its value is a JSON number representing the number
of seconds from 1970-01-01T0:0:0Z as measured in UTC until the date/time.</p>
</div>
<div class="section" id="id13">
<h4>revoked<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>If the token has been revoked.</p>
</div>
<div class="section" id="value">
<h4>value<a class="headerlink" href="#value" title="Permalink to this headline">¶</a></h4>
<p>This is the value that appears in OIDC protocol exchanges.</p>
</div>
<div class="section" id="usage-rules">
<h4>usage_rules<a class="headerlink" href="#usage-rules" title="Permalink to this headline">¶</a></h4>
<p>Rules as to how this token can be used:</p>
<dl class="simple">
<dt>expires_in</dt><dd><p>Used to calculate expires_at</p>
</dd>
<dt>supports_minting</dt><dd><p>The tokens types that can be minted based on this token. Typically a code
can be used to mint ID tokens and access and refresh tokens.</p>
</dd>
<dt>max_usage</dt><dd><p>How many times this token can be used (being used is presently defined as
used to mint other tokens). An authorization_code token can according to
the OIDC standard only be used once but then to, in the same session,
mint more then one token.</p>
</dd>
</dl>
</div>
<div class="section" id="used">
<h4>used<a class="headerlink" href="#used" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>How many times the token has been used</p>
</div></blockquote>
</div>
<div class="section" id="based-on">
<h4>based_on<a class="headerlink" href="#based-on" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Reference to the token that was used to mint this token. Might be empty if the
token was minted based on the grant it belongs to.</p>
</div></blockquote>
</div>
<div class="section" id="id14">
<h4>id<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Token identifier</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="session-info-api">
<h2>Session Info API<a class="headerlink" href="#session-info-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-subordinate">
<span id="id15"></span><h3>add_subordinate<a class="headerlink" href="#add-subordinate" title="Permalink to this headline">¶</a></h3>
<blockquote id="id16">
<div><p>…</p>
</div></blockquote>
</div>
<div class="section" id="remove-subordinate">
<h3>remove_subordinate<a class="headerlink" href="#remove-subordinate" title="Permalink to this headline">¶</a></h3>
<blockquote id="removed-subordinate">
<div><p>…</p>
</div></blockquote>
</div>
<div class="section" id="revoke">
<h3>revoke<a class="headerlink" href="#revoke" title="Permalink to this headline">¶</a></h3>
<blockquote id="id17">
<div><p>…</p>
</div></blockquote>
</div>
<div class="section" id="is-revoked">
<h3>is_revoked<a class="headerlink" href="#is-revoked" title="Permalink to this headline">¶</a></h3>
<blockquote id="id18">
<div><p>…</p>
</div></blockquote>
</div>
<div class="section" id="to-json">
<h3>to_json<a class="headerlink" href="#to-json" title="Permalink to this headline">¶</a></h3>
<blockquote id="id19">
<div><p>…</p>
</div></blockquote>
</div>
<div class="section" id="from-json">
<h3>from_json<a class="headerlink" href="#from-json" title="Permalink to this headline">¶</a></h3>
<blockquote id="id20">
<div><p>…</p>
</div></blockquote>
</div>
</div>
<div class="section" id="grant-api">
<h2>Grant API<a class="headerlink" href="#grant-api" title="Permalink to this headline">¶</a></h2>
<blockquote id="id21">
<div><p>…</p>
</div></blockquote>
</div>
<div class="section" id="token-api">
<h2>Token API<a class="headerlink" href="#token-api" title="Permalink to this headline">¶</a></h2>
<blockquote id="id22">
<div><p>…</p>
</div></blockquote>
</div>
<div class="section" id="session-manager-api">
<h2>Session Manager API<a class="headerlink" href="#session-manager-api" title="Permalink to this headline">¶</a></h2>
<blockquote id="id23">
<div><p>…</p>
</div></blockquote>
<div class="section" id="create-session">
<h3>create_session<a class="headerlink" href="#create-session" title="Permalink to this headline">¶</a></h3>
<p id="id24">Creating a new session is done by running the create_session method of
the class SessionManager. The create_session methods takes the following
arguments.</p>
<dl class="simple">
<dt>authn_event</dt><dd><p>An AuthnEvent class instance that describes the authentication event.</p>
</dd>
<dt>auth_req</dt><dd><p>The Authentication request</p>
</dd>
<dt>client_id</dt><dd><p>The client Identifier</p>
</dd>
<dt>user_id</dt><dd><p>The user identifier</p>
</dd>
<dt>sector_identifier</dt><dd><p>A possible sector identifier to be used when constructing a pairwise
subject identifier</p>
</dd>
<dt>sub_type</dt><dd><p>The type of subject identifier that should be constructed. It can either be
<em>pairwise</em> or <em>public</em>.</p>
</dd>
</dl>
<p>So a typical command would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">authn_event</span> <span class="o">=</span> <span class="n">create_authn_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
<span class="n">session_manager</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span><span class="n">authn_event</span><span class="o">=</span><span class="n">authn_event</span><span class="p">,</span> <span class="n">auth_req</span><span class="o">=</span><span class="n">auth_req</span><span class="p">,</span>
                               <span class="n">user_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                               <span class="n">sub_type</span><span class="o">=</span><span class="n">sub_type</span><span class="p">,</span> <span class="n">sector_identifier</span><span class="o">=</span><span class="n">sector_identifier</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-grant">
<h3>add_grant<a class="headerlink" href="#add-grant" title="Permalink to this headline">¶</a></h3>
<blockquote id="id25">
<div><p>add_grant(self, user_id, client_id, **kwargs)</p>
</div></blockquote>
</div>
<div class="section" id="find-token">
<h3>find_token<a class="headerlink" href="#find-token" title="Permalink to this headline">¶</a></h3>
<blockquote id="id26">
<div><p>find_token(self, session_id, token_value)</p>
</div></blockquote>
</div>
<div class="section" id="get-authentication-event">
<h3>get_authentication_event<a class="headerlink" href="#get-authentication-event" title="Permalink to this headline">¶</a></h3>
<blockquote id="id27">
<div><p>get_authentication_event(self, session_id)</p>
</div></blockquote>
</div>
<div class="section" id="get-client-session-info">
<h3>get_client_session_info<a class="headerlink" href="#get-client-session-info" title="Permalink to this headline">¶</a></h3>
<blockquote id="id28">
<div><p>get_client_session_info(self, session_id)</p>
</div></blockquote>
</div>
<div class="section" id="get-grant-by-response-type">
<h3>get_grant_by_response_type<a class="headerlink" href="#get-grant-by-response-type" title="Permalink to this headline">¶</a></h3>
<blockquote id="id29">
<div><p>get_grant_by_response_type(self, user_id, client_id)</p>
</div></blockquote>
</div>
<div class="section" id="get-session-info">
<h3>get_session_info<a class="headerlink" href="#get-session-info" title="Permalink to this headline">¶</a></h3>
<blockquote id="id30">
<div><p>get_session_info(self, session_id)</p>
</div></blockquote>
</div>
<div class="section" id="get-session-info-by-token">
<h3>get_session_info_by_token<a class="headerlink" href="#get-session-info-by-token" title="Permalink to this headline">¶</a></h3>
<blockquote id="id31">
<div><p>get_session_info_by_token(self, token_value)</p>
</div></blockquote>
</div>
<div class="section" id="get-sids-by-user-id">
<h3>get_sids_by_user_id<a class="headerlink" href="#get-sids-by-user-id" title="Permalink to this headline">¶</a></h3>
<blockquote id="id32">
<div><p>get_sids_by_user_id(self, user_id)</p>
</div></blockquote>
</div>
<div class="section" id="get-user-info">
<h3>get_user_info<a class="headerlink" href="#get-user-info" title="Permalink to this headline">¶</a></h3>
<blockquote id="id33">
<div><p>get_user_info(self, uid)</p>
</div></blockquote>
</div>
<div class="section" id="grants">
<h3>grants<a class="headerlink" href="#grants" title="Permalink to this headline">¶</a></h3>
<blockquote id="id34">
<div><p>grants(self, session_id)</p>
</div></blockquote>
</div>
<div class="section" id="revoke-client-session">
<h3>revoke_client_session<a class="headerlink" href="#revoke-client-session" title="Permalink to this headline">¶</a></h3>
<blockquote id="id35">
<div><p>revoke_client_session(self, session_id)</p>
</div></blockquote>
</div>
<div class="section" id="revoke-grant">
<h3>revoke_grant<a class="headerlink" href="#revoke-grant" title="Permalink to this headline">¶</a></h3>
<blockquote id="id36">
<div><p>revoke_grant(self, session_id)</p>
</div></blockquote>
</div>
<div class="section" id="revoke-token">
<h3>revoke_token<a class="headerlink" href="#revoke-token" title="Permalink to this headline">¶</a></h3>
<blockquote id="id37">
<div><p>revoke_token(self, session_id, token_value, recursive=False)</p>
</div></blockquote>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">idpyoidc</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction to idpyoidc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../message/index.html">idpyoidc classes and functions documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto/message.html">How to use the idpyoidc Message class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto/msg_extend.html">How to extend idpyoidc</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Welcome to Idpy OIDC OP Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">The OpenID Connect Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="conf.html">Configuration directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="conf.html#token-exchange">Token exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="conf.html#clients">Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#configure-flask-rp">Configure flask-rp</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#refresh-token">Refresh token</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#introspection-endpoint">Introspection endpoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#token-exchange">Token exchange</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Session Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html">Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="clients.html">The clients database</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../client/index.html">Welcome to oidcrp’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Welcome to Idpy OIDC OP Documentation</a><ul>
      <li>Previous: <a href="usage.html" title="previous chapter">Usage</a></li>
      <li>Next: <a href="developers.html" title="next chapter">Tests</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Roland Hedberg.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/server/contents/session_management.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>