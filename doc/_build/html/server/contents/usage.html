
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Usage &#8212; idpyoidc 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Session Management" href="session_management.html" />
    <link rel="prev" title="Configuration directives" href="conf.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>Some examples, how to run [flask_op](<a class="reference external" href="https://github.com/IdentityPython/oidc-op/tree/master/example/flask_op">https://github.com/IdentityPython/oidc-op/tree/master/example/flask_op</a>) and [django_op](<a class="reference external" href="https://github.com/peppelinux/django-oidc-op">https://github.com/peppelinux/django-oidc-op</a>) but also some typical configuration in relation to common use cases.</p>
</div>
<div class="section" id="configure-flask-rp">
<h1>Configure flask-rp<a class="headerlink" href="#configure-flask-rp" title="Permalink to this headline">¶</a></h1>
<p>_JWTConnect-<a href="#id1"><span class="problematic" id="id2">Python-OidcRP_</span></a> is Relaying Party for tests, see [related page](<a class="reference external" href="https://github.com/openid/JWTConnect-Python-OidcRP">https://github.com/openid/JWTConnect-Python-OidcRP</a>).
You can run a working instance of <cite>JWTConnect-Python-OidcRP.flask_rp</cite> with:</p>
<blockquote>
<div><p>pip install git+https://github.com/openid/JWTConnect-Python-OidcRP.git</p>
</div></blockquote>
<p>get entire project to have examples files
git clone <a class="reference external" href="https://github.com/openid/JWTConnect-Python-OidcRP.git">https://github.com/openid/JWTConnect-Python-OidcRP.git</a>
cd JWTConnect-Python-OidcRP/example/flask_rp</p>
<p>run it as it comes</p>
<blockquote>
<div><p>bash run.sh</p>
</div></blockquote>
<p>Now you can connect to <cite>https://127.0.0.1:8090/</cite> to see the RP landing page and select your authentication endpoint.</p>
<div class="section" id="authentication-examples">
<h2>Authentication examples<a class="headerlink" href="#authentication-examples" title="Permalink to this headline">¶</a></h2>
<p>![RP](../_images/1.png)</p>
<p>Get to the RP landing page to choose your authentication endpoint. The first option aims to use _Provider <a href="#id3"><span class="problematic" id="id4">Discovery_</span></a>.</p>
<p>![OP Auth](../_images/2.png)</p>
<p>The AS/OP supports dynamic client registration, it accepts the authentication request and prompt to us the login form. Read [passwd.json](<a class="reference external" href="https://github.com/IdentityPython/oidc-op/blob/master/example/flask_op/passwd.json">https://github.com/IdentityPython/oidc-op/blob/master/example/flask_op/passwd.json</a>) file to get credentials.</p>
<p>![Access](../_images/3.png)</p>
<p>The identity representation with the information fetched from the user info endpoint.</p>
<p>![Logout](../_images/4.png)</p>
<p>We can even test the single logout</p>
</div>
</div>
<div class="section" id="refresh-token">
<h1>Refresh token<a class="headerlink" href="#refresh-token" title="Permalink to this headline">¶</a></h1>
<p>Here an example about how to refresh a token.
It is important to consider that only scope=offline_access will get a usable refresh token:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s2">&quot;DBP60x3KUQfCYWZlqFaS_Q&quot;</span>
<span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="s2">&quot;8526270403788522b2444e87ea90c53bcafb984119cec92eeccc12f1&quot;</span>
<span class="n">REFRESH_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;Z0FBQUFBQ ... lN2JNODYtZThjMnFsZUNDcg==&quot;</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;grant_type&quot;</span> <span class="p">:</span> <span class="s2">&quot;refresh_token&quot;</span><span class="p">,</span>
    <span class="s2">&quot;client_id&quot;</span> <span class="p">:</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{CLIENT_ID}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;client_secret&quot;</span> <span class="p">:</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{CLIENT_SECRET}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;refresh_token&quot;</span> <span class="p">:</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{REFRESH_TOKEN}</span><span class="s2">&quot;</span>
<span class="p">}</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span> <span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s1">&#39;https://127.0.0.1:8000/oidcop/token&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
<span class="p">)</span>
</pre></div>
</div>
<p>oidc-op will return a json response like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
 <span class="s1">&#39;access_token&#39;</span><span class="p">:</span> <span class="s1">&#39;eyJhbGc ... CIOH_09tT_YVa_gyTqg&#39;</span><span class="p">,</span>
 <span class="s1">&#39;token_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Bearer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;scope&#39;</span><span class="p">:</span> <span class="s1">&#39;openid profile email address phone offline_access&#39;</span><span class="p">,</span>
 <span class="s1">&#39;refresh_token&#39;</span><span class="p">:</span> <span class="s1">&#39;Z0FBQ ... 1TE16cm1Tdg==&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="introspection-endpoint">
<h1>Introspection endpoint<a class="headerlink" href="#introspection-endpoint" title="Permalink to this headline">¶</a></h1>
<p>Here an example about how to consume oidc-op introspection endpoint.
This example uses a client with an HTTP Basic Authentication:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">TOKEN</span> <span class="o">=</span> <span class="s2">&quot;eyJhbGciOiJFUzI1NiIsImtpZCI6IlQwZGZTM1ZVYUcxS1ZubG9VVTQwUXpJMlMyMHpjSHBRYlMxdGIzZ3hZVWhCYzNGaFZWTlpTbWhMTUEifQ.eyJzY29wZSI6IFsib3BlbmlkIiwgInByb2ZpbGUiLCAiZW1haWwiLCAiYWRkcmVzcyIsICJwaG9uZSJdLCAiYXVkIjogWyJvTHlSajdzSkozWHZBWWplRENlOHJRIl0sICJqdGkiOiAiOWQzMjkzYjZiYmNjMTFlYmEzMmU5ODU0MWIwNzE1ZWQiLCAiY2xpZW50X2lkIjogIm9MeVJqN3NKSjNYdkFZamVEQ2U4clEiLCAic3ViIjogIm9MeVJqN3NKSjNYdkFZamVEQ2U4clEiLCAic2lkIjogIlowRkJRVUZCUW1keGJIVlpkRVJKYkZaUFkxQldaa0pQVUVGc1pHOUtWWFZ3VFdkZmVEY3diMVprYmpSamRrNXRMVzB4YTNnelExOHlRbHBHYTNRNVRHZEdUUzF1UW1sMlkzVnhjRE5sUm01dFRFSmxabGRXYVhJeFpFdHVSV2xtUzBKcExWTmFaRzV3VjJodU0yNXlSbTU0U1ZWVWRrWTRRM2x2UWs1TlpVUk9SazlGVlVsRWRteGhjWGx2UWxWRFdubG9WbTFvZGpORlVUSnBkaTFaUTFCcFptZFRabWRDVWt0YVNuaGtOalZCWVhkcGJFNXpaV2xOTTFCMk0yaE1jMDV0ZGxsUlRFc3dObWxsYUcxa1lrTkhkemhuU25OaWFWZE1kVUZzZDBwWFdWbzFiRWhEZFhGTFFXWTBPVzl5VjJOUk4zaGtPRDA9IiwgInR0eXBlIjogIlQiLCAiaXNzIjogImh0dHBzOi8vMTI3LjAuMC4xOjgwMDAiLCAiaWF0IjogMTYyMTc3NzMwNSwgImV4cCI6IDE2MjE3ODA5MDV9.pVqxUNznsoZu9ND18IEMJIHDOT6_HxzoFiTLsniNdbAdXTuOoiaKeRTqtDyjT9WuUPszdHkVjt5xxeFX8gQMuA&quot;</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">TOKEN</span><span class="p">,</span>
 <span class="s1">&#39;token_type_hint&#39;</span><span class="p">:</span> <span class="s1">&#39;access_token&#39;</span>
<span class="p">}</span>

<span class="n">_basic_secret</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span>
    <span class="n">f</span><span class="s1">&#39;{&quot;oLyRj7sJJ3XvAYjeDCe8rQ&quot;}:{&quot;53fb49f2a6501ec775355c89750dc416744a3253138d5a04e409b313&quot;}&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Authorization&#39;</span><span class="p">:</span> <span class="n">f</span><span class="s2">&quot;Basic {_basic_secret.decode()}&quot;</span>
<span class="p">}</span>

<span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://127.0.0.1:8000/introspection&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</pre></div>
</div>
<p>oidc-op will return a json response like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
  <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;openid profile email address phone&quot;</span><span class="p">,</span>
  <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;oLyRj7sJJ3XvAYjeDCe8rQ&quot;</span><span class="p">,</span>
  <span class="s2">&quot;token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;access_token&quot;</span><span class="p">,</span>
  <span class="s2">&quot;exp&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;iat&quot;</span><span class="p">:</span> <span class="mi">1621777305</span><span class="p">,</span>
  <span class="s2">&quot;sub&quot;</span><span class="p">:</span> <span class="s2">&quot;a7b0dea2958aec275a789d7d7dc8e7d09c6316dd4fc6ae92742ed3297e14dded&quot;</span><span class="p">,</span>
  <span class="s2">&quot;iss&quot;</span><span class="p">:</span> <span class="s2">&quot;https://127.0.0.1:8000&quot;</span><span class="p">,</span>
  <span class="s2">&quot;aud&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;oLyRj7sJJ3XvAYjeDCe8rQ&quot;</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="token-exchange">
<h1>Token exchange<a class="headerlink" href="#token-exchange" title="Permalink to this headline">¶</a></h1>
<p>Here an example about how to exchange an access token for a new access token.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">CLIENT_ID</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">SUBJECT_TOKEN</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">REQUESTED_TOKEN_TYPE</span><span class="o">=</span><span class="s2">&quot;urn:ietf:params:oauth:token-type:access_token&quot;</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;grant_type&quot;</span> <span class="p">:</span> <span class="s2">&quot;urn:ietf:params:oauth:grant-type:token-exchange&quot;</span><span class="p">,</span>
    <span class="s2">&quot;requested_token_type&quot;</span> <span class="p">:</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{REQUESTED_TOKEN_TYPE}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;client_id&quot;</span> <span class="p">:</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{CLIENT_ID}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;client_secret&quot;</span> <span class="p">:</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{CLIENT_SECRET}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subject_token&quot;</span> <span class="p">:</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{SUBJECT_TOKEN}</span><span class="s2">&quot;</span>
<span class="p">}</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span> <span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s1">&#39;https://example.com/OIDC/token&#39;</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span>
<span class="p">)</span>
</pre></div>
</div>
<p>oidc-op will return a json response like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;eyJhbGciOiJFUzI1NiIsI...Bo6aQcOKEN-1U88jjKxLb-9Q&quot;</span><span class="p">,</span>
    <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot;openid email&quot;</span><span class="p">,</span>
    <span class="s2">&quot;issued_token_type&quot;</span><span class="p">:</span> <span class="s2">&quot;urn:ietf:params:oauth:token-type:access_token&quot;</span><span class="p">,</span>
    <span class="s2">&quot;expires_in&quot;</span><span class="p">:</span> <span class="mi">86400</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order to request a refresh token the value of <cite>requested_token_type</cite> should be set to
<cite>urn:ietf:params:oauth:token-type:refresh_token</cite>.</p>
<p>The [RFC-8693](<a class="reference external" href="https://datatracker.ietf.org/doc/html/rfc8693">https://datatracker.ietf.org/doc/html/rfc8693</a>) describes the <cite>audience</cite> parameter that
defines the authorized targets of a token exchange request.
If <cite>subject_token = urn:ietf:params:oauth:token-type:refresh_token</cite> then <cite>audience</cite> should not be
included in the token exchange request.</p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">idpyoidc</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction to idpyoidc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../message/index.html">idpyoidc classes and functions documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto/message.html">How to use the idpyoidc Message class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howto/msg_extend.html">How to extend idpyoidc</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Welcome to Idpy OIDC OP Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">The OpenID Connect Provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="conf.html">Configuration directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="conf.html#token-exchange">Token exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="conf.html#clients">Clients</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-flask-rp">Configure flask-rp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#refresh-token">Refresh token</a></li>
<li class="toctree-l2"><a class="reference internal" href="#introspection-endpoint">Introspection endpoint</a></li>
<li class="toctree-l2"><a class="reference internal" href="#token-exchange">Token exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="session_management.html">Session Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html">Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="clients.html">The clients database</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../client/index.html">Welcome to oidcrp’s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../client/index.html#indices-and-tables">Indices and tables</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Welcome to Idpy OIDC OP Documentation</a><ul>
      <li>Previous: <a href="conf.html" title="previous chapter">Configuration directives</a></li>
      <li>Next: <a href="session_management.html" title="next chapter">Session Management</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Roland Hedberg.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/server/contents/usage.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>